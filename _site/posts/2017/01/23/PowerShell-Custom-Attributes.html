<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Custom function and property attributes.</title>
  <meta name="description" content="A post about PowerShell objects.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.lukegriffith.co.uk/posts/2017/01/23/PowerShell-Custom-Attributes.html">
  <link rel="alternate" type="application/rss+xml" title="Luke Griffith" href="http://www.lukegriffith.co.uk/feed.xml">

  


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Luke Griffith</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about.html">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Custom function and property attributes.</h1>
    <p class="post-meta"><time datetime="2017-01-23T22:00:21+00:00" itemprop="datePublished">Jan 23, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">luke_griffith</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h1 id="why-do-you-want-this">Why do you want this?</h1>
<p>These decorations can be added to powershell elements to provide more information via reflection to outside frameworks, allowing for more modular and extensible module design.</p>

<h1 id="property-attributes">Property attributes</h1>
<p>These can be applied to properties of classes to give extra meaning to it, effectively adding meta data. This meta data can be used by PowerShell developers to utilize framework instructions when working with an application. 
This type of scenario might come when you’re wanting to map class properties to API queries.</p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="cm">&lt;#
    .Notes
        Created: 23/01/2017 
        Author: Luke Griffith

    .Synopsis
        Creates a property attribute that can be mapped to class properties.

    .Description
        apiObject informs the Mapper that this property is a member 
        of the API and should be mapped accordingly.

    .Example
        class Software {
            [apiObject(shouldQuery=$true)]
            [String]$Name   
            ...
    
#&gt;</span>
<span class="k">class </span>apiObject : System.Attribute <span class="o">{</span>
    <span class="o">[</span><span class="kt">bool</span><span class="o">]</span><span class="nv">$shouldQuery</span>
<span class="o">}</span></code></pre></figure>

<p>Above we’ve defined the apiObject, inheriting from the System.Attribute class it inherits the required functionality to make this class an attribute. 
Now I can use the class to add metadata to properties.</p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="k">class </span>Software <span class="o">{</span>

    <span class="o">[</span>apiObject<span class="o">(</span><span class="nv">shouldQuery</span><span class="o">=</span><span class="nv">$true</span><span class="o">)]</span>
    <span class="o">[</span><span class="kt">String</span><span class="o">]</span><span class="nv">$Name</span>

    Software<span class="o">([</span>apiMapper]<span class="nv">$mapper</span><span class="o">){</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>Now we can create a software class, and add the attribute to any property. We can reflect on the property to obtain the named arguments.</p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="o">[</span>Software].GetProperties<span class="o">()</span>.Where<span class="o">{</span><span class="nv">$_</span>.Name -eq <span class="s2">"Name"</span><span class="o">}</span></code></pre></figure>

<h1 id="function-attributes">Function attributes</h1>

<p>These can be added to powershell functions, just like the [CmdletBinding()] class. These can be pulled back from the FunctionInfo object.</p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="c1"># enum for class options</span>
enum httpMethods <span class="o">{</span>

    GET
    PUT
    POST
    DELETE

<span class="o">}</span>

<span class="cm">&lt;#
    .Notes 
    Luke Griffith
    23/01/17

    .Synopsis
    Function attribute that interfaces with WebModule

    .Description
    Can be used to add WebModule properties like route, and method.

#&gt;</span>
<span class="k">class </span>Web : System.Management.Automation.CmdletCommonMetadataAttribute <span class="o">{</span> 

    <span class="o">[</span>httpMethods]<span class="nv">$Method</span>
    <span class="o">[</span><span class="kt">string</span><span class="o">]</span><span class="nv">$Route</span>

    Web<span class="o">(){</span> 

    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">&lt;#
    .Notes 
    Luke Griffith
    23/01/17

    .Synopsis 
    Obtains host data from the config database registry.

    .Description
    Using the ConfigDB module, it queries the registry for the computer name provided.
#&gt;</span>
<span class="k">function </span>Get-HostData <span class="o">{</span>
    <span class="o">[</span>Web<span class="o">(</span><span class="nv">Method</span><span class="o">=</span><span class="s2">"GET"</span>, <span class="nv">Route</span><span class="o">=</span><span class="s2">"api/hosts"</span><span class="o">)]</span>
    <span class="k">param</span><span class="o">(</span>
        <span class="o">[</span><span class="kt">String</span><span class="o">]</span><span class="nv">$ComputerName</span>
    <span class="o">)</span>

    Get-ConfigDBItem <span class="nv">$ComputerName</span>
<span class="o">}</span></code></pre></figure>

<p>In the above example, I’ve coded out a Web function attribute and this can be added to the function much like the CmdletBinding attribute.
In this case, the attributes provide a web framework data around the HTML route for this function to be called at, and what method it takes.</p>

<p>To obtain this metadata, I just need to get the FunctionInfo.</p>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="nv">$function</span> <span class="o">=</span> <span class="nb">Get-Command </span>Get-HostData

<span class="nv">$function</span>.ScriptBlock.Attributes


<span class="c1"># Method                  : GET</span>
<span class="c1"># Route                   : api/hosts</span>
<span class="c1"># DefaultParameterSetName : </span>
<span class="c1"># SupportsShouldProcess   : False</span>
<span class="c1"># SupportsPaging          : False</span>
<span class="c1"># SupportsTransactions    : False</span>
<span class="c1"># ConfirmImpact           : Medium</span>
<span class="c1"># HelpUri                 : </span>
<span class="c1"># RemotingCapability      : PowerShell</span>
<span class="c1"># TypeId                  : Web</span></code></pre></figure>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Luke Griffith</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Luke Griffith</li>
          <li><a href="mailto:lukemgriffith@gmail.com">lukemgriffith@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/lukemgriffith"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">lukemgriffith</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/LukeGriffith"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">LukeGriffith</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Luke's place to talk about work and studies.
</p>
      </div>
    </div>




  </div>

</footer>


  </body>

</html>
